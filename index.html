<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Faizan-e-Raza Madarsa Result Portal</title>
<style>
:root {
  --primary: #2e7d32;
  --primary-dark: #1b5e20;
  --primary-light: #4caf50;
  --secondary: #d32f2f;
  --accent: #ff9800;
  --success: #4caf50;
  --danger: #f44336;
  --warning: #ffc107;
  --light-bg: #f5fff5;
  --card-bg: #ffffff;
  --text: #2c3e50;
  --text-light: #7f8c8d;
  --border: #c8e6c9;
  --shadow: 0 4px 20px rgba(46, 125, 50, 0.08);
  --gradient: linear-gradient(135deg, #2e7d32 0%, #4caf50 100%);
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body { 
  font-family: 'Poppins', 'Inter', 'Segoe UI', system-ui, sans-serif; 
  background: var(--light-bg); 
  color: var(--text);
  line-height: 1.6;
  min-height: 100vh;
}

/* VIP Font for Result Cards */
@import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Montserrat:wght@600;800&display=swap');

.vip-font {
  font-family: 'Playfair Display', serif;
  font-weight: 700;
}

.vip-font-bold {
  font-family: 'Montserrat', sans-serif;
  font-weight: 800;
}

/* Header with green design */
header { 
  background: var(--gradient); 
  color: white; 
  text-align: center; 
  padding: 1.5rem 1rem; 
  font-size: 1.8rem; 
  font-weight: 700;
  box-shadow: 0 4px 12px rgba(46, 125, 50, 0.15);
  position: relative;
  overflow: hidden;
}

header::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(90deg, #ff9800, #ff5722);
}

.logo-container {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 15px;
  margin-bottom: 10px;
}

.logo-container span {
  font-size: 2.5rem;
}

.subtitle {
  font-size: 1rem;
  opacity: 0.9;
  font-weight: 400;
  letter-spacing: 1px;
}

/* Modern Navigation */
nav { 
  display: flex; 
  justify-content: center; 
  flex-wrap: wrap; 
  background: var(--card-bg); 
  border-bottom: 1px solid var(--border);
  padding: 0.8rem;
  position: sticky;
  top: 0;
  z-index: 100;
  box-shadow: 0 2px 10px rgba(46, 125, 50, 0.05);
  backdrop-filter: blur(10px);
  background: rgba(255, 255, 255, 0.98);
}

nav button { 
  margin: 6px; 
  padding: 12px 24px; 
  border: none; 
  background: var(--primary); 
  color: white; 
  border-radius: 8px; 
  cursor: pointer;
  font-size: 0.95rem;
  font-weight: 600;
  transition: all 0.3s ease;
  flex: 1;
  min-width: 140px;
  max-width: 200px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

nav button:hover { 
  background: var(--primary-dark); 
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(46, 125, 50, 0.2);
}

nav button:active {
  transform: translateY(0);
}

section { 
  display: none; 
  padding: 30px 20px; 
  max-width: 1200px;
  margin: 0 auto;
  animation: fadeIn 0.5s ease;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

.active { 
  display: block; 
}

.hidden { 
  display: none; 
}

/* Card Design */
.card {
  background: var(--card-bg);
  border-radius: 16px;
  padding: 30px;
  margin: 25px 0;
  box-shadow: var(--shadow);
  border: 1px solid var(--border);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.card:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 30px rgba(46, 125, 50, 0.12);
}

.card-header {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 25px;
  padding-bottom: 15px;
  border-bottom: 2px solid #e8f5e9;
}

.card-header h2 {
  color: var(--primary);
  font-size: 1.8rem;
  margin: 0;
}

.card-header span {
  font-size: 1.8rem;
}

/* Form Elements */
input, select, textarea { 
  width: 100%; 
  padding: 14px 16px; 
  margin-top: 8px; 
  border: 2px solid var(--border); 
  border-radius: 10px; 
  font-size: 1rem;
  font-family: inherit;
  transition: all 0.3s ease;
  background: #f8f9fa;
}

input:focus, select:focus, textarea:focus {
  border-color: var(--primary);
  outline: none;
  box-shadow: 0 0 0 3px rgba(46, 125, 50, 0.1);
  background: white;
}

label {
  display: block;
  margin-bottom: 8px;
  font-weight: 600;
  color: var(--text);
  font-size: 0.95rem;
}

/* Buttons */
.btn { 
  background: linear-gradient(135deg, var(--primary), var(--primary-light)); 
  color: white; 
  border: none; 
  padding: 14px 28px; 
  border-radius: 10px; 
  cursor: pointer; 
  margin-top: 10px;
  font-size: 1rem;
  font-weight: 600;
  transition: all 0.3s ease;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  letter-spacing: 0.5px;
}

.btn:hover { 
  background: linear-gradient(135deg, var(--primary-dark), var(--primary)); 
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(46, 125, 50, 0.2);
}

.btn:active {
  transform: translateY(0);
}

.btn-info { 
  background: linear-gradient(135deg, #2196F3, #1976D2); 
  color: white; 
  border: none; 
  padding: 10px 20px; 
  border-radius: 8px; 
  cursor: pointer; 
  font-weight: 600;
  transition: all 0.3s ease;
}

.btn-info:hover { 
  background: linear-gradient(135deg, #1976D2, #0d47a1); 
  transform: translateY(-2px);
}

.btn-danger { 
  background: linear-gradient(135deg, #f44336, #d32f2f); 
  color: white; 
  border: none; 
  padding: 10px 20px; 
  border-radius: 8px; 
  cursor: pointer; 
  font-weight: 600;
  transition: all 0.3s ease;
}

.btn-danger:hover { 
  background: linear-gradient(135deg, #d32f2f, #b71c1c); 
  transform: translateY(-2px);
}

.btn-warning { 
  background: linear-gradient(135deg, #ff9800, #f57c00); 
  color: white; 
  border: none; 
  padding: 10px 20px; 
  border-radius: 8px; 
  cursor: pointer; 
  font-weight: 600;
  transition: all 0.3s ease;
}

.btn-warning:hover { 
  background: linear-gradient(135deg, #f57c00, #e65100); 
  transform: translateY(-2px);
}

.btn-success { 
  background: linear-gradient(135deg, #4CAF50, #388E3C); 
  color: white; 
  border: none; 
  padding: 10px 20px; 
  border-radius: 8px; 
  cursor: pointer; 
  font-weight: 600;
  transition: all 0.3s ease;
}

.btn-success:hover { 
  background: linear-gradient(135deg, #388E3C, #2E7D32); 
  transform: translateY(-2px);
}

.btn-group {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
  margin-top: 20px;
}

/* Tables */
.table-container {
  overflow-x: auto;
  border-radius: 12px;
  box-shadow: var(--shadow);
  margin: 25px 0;
}

table { 
  width: 100%; 
  border-collapse: separate;
  border-spacing: 0;
  margin-top: 0;
  border-radius: 12px;
  overflow: hidden;
}

th, td { 
  border: none; 
  padding: 16px 12px; 
  text-align: center; 
  border-bottom: 1px solid var(--border);
}

th { 
  background: linear-gradient(135deg, var(--primary), var(--primary-light)); 
  color: white; 
  font-weight: 600;
  font-size: 0.95rem;
  letter-spacing: 0.5px;
}

tbody tr {
  transition: all 0.3s ease;
}

tbody tr:hover {
  background: #f8fff9;
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(46, 125, 50, 0.05);
}

tbody tr:nth-child(even) {
  background: #f8f9fa;
}

/* ULTRA BEAUTIFUL VIP RESULT CARD */
.vip-result-display {
  background: linear-gradient(135deg, #ffffff 0%, #f8fff8 50%, #f0fff0 100%);
  border-radius: 28px;
  padding: 50px;
  margin: 40px 0;
  box-shadow: 
    0 25px 60px rgba(46, 125, 50, 0.15),
    0 0 0 1px rgba(46, 125, 50, 0.05),
    inset 0 0 0 1px rgba(255, 255, 255, 0.5);
  border: 4px solid transparent;
  background-clip: padding-box;
  position: relative;
  overflow: hidden;
  animation: slideUp 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

@keyframes slideUp {
  from { 
    opacity: 0; 
    transform: translateY(60px) scale(0.95); 
  }
  to { 
    opacity: 1; 
    transform: translateY(0) scale(1); 
  }
}

.vip-result-display::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 10px;
  background: linear-gradient(90deg, 
    var(--primary), 
    #4caf50, 
    var(--accent), 
    #ff9800,
    var(--primary));
  background-size: 300% 100%;
  animation: gradientFlow 4s linear infinite;
  z-index: 2;
}

@keyframes gradientFlow {
  0% { background-position: 0% 50%; }
  100% { background-position: 300% 50%; }
}

.vip-result-display::after {
  content: 'üèÜ';
  position: absolute;
  top: 30px;
  right: 30px;
  font-size: 8rem;
  opacity: 0.06;
  z-index: 1;
  animation: trophyFloat 6s ease-in-out infinite;
}

@keyframes trophyFloat {
  0%, 100% { transform: translateY(0) rotate(0deg); }
  50% { transform: translateY(-20px) rotate(5deg); }
}

/* Certificate-style corner decorations */
.corner-decoration {
  position: absolute;
  width: 60px;
  height: 60px;
  z-index: 1;
  pointer-events: none;
}

.corner-tl {
  top: 20px;
  left: 20px;
  border-top: 3px solid var(--primary);
  border-left: 3px solid var(--primary);
  border-top-left-radius: 15px;
}

.corner-tr {
  top: 20px;
  right: 20px;
  border-top: 3px solid var(--accent);
  border-right: 3px solid var(--accent);
  border-top-right-radius: 15px;
}

.corner-bl {
  bottom: 20px;
  left: 20px;
  border-bottom: 3px solid #4caf50;
  border-left: 3px solid #4caf50;
  border-bottom-left-radius: 15px;
}

.corner-br {
  bottom: 20px;
  right: 20px;
  border-bottom: 3px solid #2e7d32;
  border-right: 3px solid #2e7d32;
  border-bottom-right-radius: 15px;
}

/* Enhanced Header */
.vip-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 45px;
  padding-bottom: 30px;
  border-bottom: 3px solid #e8f5e9;
  position: relative;
  z-index: 3;
}

.vip-student-info h2 {
  background: linear-gradient(135deg, var(--primary-dark), var(--primary));
  -webkit-background-clip: text;
  background-clip: text;
  color: transparent;
  font-size: 3rem;
  margin-bottom: 15px;
  font-weight: 900;
  letter-spacing: -0.5px;
  text-shadow: 3px 3px 6px rgba(0,0,0,0.05);
  font-family: 'Montserrat', sans-serif;
  position: relative;
  display: inline-block;
}

.vip-student-info h2::after {
  content: '';
  position: absolute;
  bottom: -5px;
  left: 0;
  width: 100%;
  height: 4px;
  background: linear-gradient(90deg, var(--primary), transparent);
  border-radius: 2px;
}

.vip-student-meta {
  display: flex;
  gap: 20px;
  flex-wrap: wrap;
  margin-top: 15px;
}

.vip-meta-item {
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 1.2rem;
  color: var(--text);
  font-weight: 600;
  padding: 8px 18px;
  background: rgba(76, 175, 80, 0.08);
  border-radius: 50px;
  border: 2px solid rgba(76, 175, 80, 0.15);
  backdrop-filter: blur(5px);
}

.vip-meta-item span {
  font-size: 1.4rem;
  opacity: 0.9;
}

/* Enhanced Position Badge */
.vip-position-badge {
  background: linear-gradient(135deg, 
    rgba(255, 215, 0, 1), 
    rgba(255, 193, 7, 1),
    rgba(255, 152, 0, 1));
  color: #8B4513;
  padding: 18px 35px;
  border-radius: 50px;
  font-size: 2rem;
  font-weight: 900;
  box-shadow: 
    0 12px 30px rgba(255, 215, 0, 0.25),
    0 0 0 4px rgba(255, 255, 255, 0.5),
    inset 0 0 20px rgba(255, 255, 255, 0.3);
  font-family: 'Playfair Display', serif;
  border: 3px solid white;
  text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
  animation: badgeGlow 2s infinite alternate;
  position: relative;
  overflow: hidden;
  z-index: 2;
}

@keyframes badgeGlow {
  from {
    box-shadow: 
      0 12px 30px rgba(255, 215, 0, 0.25),
      0 0 0 4px rgba(255, 255, 255, 0.5);
  }
  to {
    box-shadow: 
      0 20px 45px rgba(255, 215, 0, 0.4),
      0 0 0 4px rgba(255, 255, 255, 0.8),
      0 0 40px rgba(255, 215, 0, 0.3);
  }
}

.vip-position-badge::before {
  content: '';
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: linear-gradient(
    45deg,
    transparent,
    rgba(255, 255, 255, 0.3),
    transparent
  );
  transform: rotate(45deg);
  animation: shine 3s infinite;
}

@keyframes shine {
  0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
  100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
}

/* Enhanced Results Grid */
.vip-results-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 30px;
  margin: 45px 0;
  position: relative;
  z-index: 2;
}

.vip-result-item {
  background: linear-gradient(135deg, #ffffff, #f8faf8);
  padding: 35px 25px;
  border-radius: 22px;
  text-align: center;
  box-shadow: 
    0 15px 35px rgba(46, 125, 50, 0.1),
    inset 0 0 0 1px rgba(255, 255, 255, 0.5);
  border: 2px solid #e8f5e9;
  transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  position: relative;
  overflow: hidden;
}

.vip-result-item::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 6px;
  background: linear-gradient(90deg, var(--primary), var(--primary-light));
  border-radius: 3px 3px 0 0;
}

.vip-result-item:hover {
  transform: translateY(-12px) scale(1.02);
  box-shadow: 
    0 25px 50px rgba(46, 125, 50, 0.15),
    0 0 0 2px var(--primary-light);
  border-color: var(--primary-light);
}

.vip-result-item h4 {
  color: var(--primary-dark);
  font-size: 1.4rem;
  margin-bottom: 25px;
  font-weight: 700;
  letter-spacing: 1px;
  text-transform: uppercase;
  position: relative;
  display: inline-block;
}

.vip-result-item h4::after {
  content: '';
  position: absolute;
  bottom: -10px;
  left: 50%;
  transform: translateX(-50%);
  width: 50px;
  height: 3px;
  background: var(--primary);
  border-radius: 2px;
}

.vip-result-value {
  font-size: 3.8rem;
  font-weight: 900;
  margin: 20px 0;
  font-family: 'Montserrat', sans-serif;
  background: linear-gradient(135deg, var(--primary), var(--primary-dark));
  -webkit-background-clip: text;
  background-clip: text;
  color: transparent;
  text-shadow: 3px 3px 6px rgba(0,0,0,0.05);
  position: relative;
}

.vip-result-progress {
  height: 10px;
  background: rgba(232, 245, 233, 0.5);
  border-radius: 5px;
  margin: 20px 0;
  overflow: hidden;
  position: relative;
}

.vip-result-progress-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--primary), var(--primary-light));
  border-radius: 5px;
  transition: width 1.5s ease-out;
  position: relative;
}

.vip-result-progress-fill::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(
    90deg,
    transparent,
    rgba(255, 255, 255, 0.4),
    transparent
  );
  animation: progressShine 2s infinite;
}

@keyframes progressShine {
  0% { transform: translateX(-100%); }
  100% { transform: translateX(100%); }
}

.vip-percentage {
  color: var(--text-light);
  font-size: 1.2rem;
  font-weight: 600;
  margin-top: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

/* Enhanced Stats Cards */
.vip-stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 25px;
  margin: 45px 0;
  position: relative;
  z-index: 2;
}

.vip-stat-card {
  background: linear-gradient(135deg, #ffffff, #f8faf8);
  padding: 30px;
  border-radius: 20px;
  text-align: center;
  box-shadow: 
    0 12px 30px rgba(46, 125, 50, 0.08),
    inset 0 0 0 1px rgba(255, 255, 255, 0.5);
  border: 2px solid #e8f5e9;
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

.vip-stat-card:hover {
  transform: translateY(-8px);
  box-shadow: 
    0 20px 40px rgba(46, 125, 50, 0.12),
    0 0 0 2px var(--primary-light);
}

.vip-stat-icon {
  font-size: 3.2rem;
  margin-bottom: 25px;
  display: block;
  filter: drop-shadow(3px 3px 6px rgba(0,0,0,0.1));
}

.vip-stat-value {
  font-size: 3rem;
  font-weight: 900;
  color: var(--primary);
  font-family: 'Montserrat', sans-serif;
  margin: 15px 0;
  text-shadow: 2px 2px 4px rgba(0,0,0,0.05);
}

.vip-stat-label {
  color: var(--text-light);
  font-size: 1.1rem;
  font-weight: 500;
  letter-spacing: 0.5px;
  text-transform: uppercase;
}

/* Enhanced Remarks Section */
.vip-remarks-section {
  background: linear-gradient(135deg, 
    rgba(232, 245, 233, 0.9),
    rgba(200, 230, 201, 0.9));
  border-radius: 22px;
  padding: 45px;
  margin-top: 55px;
  border-left: 10px solid var(--primary);
  position: relative;
  overflow: hidden;
  backdrop-filter: blur(10px);
  box-shadow: 
    0 15px 35px rgba(46, 125, 50, 0.1),
    inset 0 0 0 1px rgba(255, 255, 255, 0.3);
}

.vip-remarks-section::before {
  content: 'üí¨';
  position: absolute;
  top: 25px;
  right: 25px;
  font-size: 6rem;
  opacity: 0.08;
  animation: remarkFloat 8s ease-in-out infinite;
}

@keyframes remarkFloat {
  0%, 100% { transform: translateY(0) rotate(0deg); }
  50% { transform: translateY(-15px) rotate(3deg); }
}

.vip-remarks-header {
  display: flex;
  align-items: center;
  gap: 18px;
  margin-bottom: 30px;
}

.vip-remarks-header h3 {
  color: var(--primary-dark);
  font-size: 2.2rem;
  margin: 0;
  font-family: 'Montserrat', sans-serif;
  text-shadow: 2px 2px 4px rgba(0,0,0,0.05);
  position: relative;
}

.vip-remarks-header h3::after {
  content: '';
  position: absolute;
  bottom: -8px;
  left: 0;
  width: 60px;
  height: 4px;
  background: var(--primary);
  border-radius: 2px;
}

.vip-remarks-content {
  font-size: 1.8rem;
  line-height: 1.9;
  color: var(--text);
  background: rgba(255, 255, 255, 0.95);
  padding: 35px;
  border-radius: 18px;
  border: 1px solid rgba(46, 125, 50, 0.1);
  box-shadow: 
    0 8px 25px rgba(46, 125, 50, 0.05),
    inset 0 0 0 1px rgba(255, 255, 255, 0.5);
  font-weight: 500;
  font-family: 'Playfair Display', serif;
  position: relative;
  z-index: 1;
  font-style: italic;
  text-align: center;
}

/* Gold/Silver/Bronze specific styles */
.gold-card .vip-result-item {
  border-color: #FFD700;
}

.gold-card .vip-result-item::before {
  background: linear-gradient(90deg, #FFD700, #FFC107);
}

.silver-card .vip-result-item {
  border-color: #C0C0C0;
}

.silver-card .vip-result-item::before {
  background: linear-gradient(90deg, #C0C0C0, #B0B0B0);
}

.bronze-card .vip-result-item {
  border-color: #CD7F32;
}

.bronze-card .vip-result-item::before {
  background: linear-gradient(90deg, #CD7F32, #A0522D);
}

/* VIP Position Styles */
.position-1st {
  background: linear-gradient(135deg, #FFD700, #FFC107, #FF9800);
  -webkit-background-clip: text;
  background-clip: text;
  color: transparent;
  font-weight: 900;
  font-size: 4rem;
  font-family: 'Playfair Display', serif;
  text-shadow: 
    0 0 30px rgba(255, 215, 0, 0.5),
    0 0 60px rgba(255, 215, 0, 0.3);
  animation: goldGlow 3s infinite alternate;
}

@keyframes goldGlow {
  from { 
    text-shadow: 
      0 0 20px rgba(255, 215, 0, 0.6),
      0 0 40px rgba(255, 215, 0, 0.4),
      0 0 60px rgba(255, 215, 0, 0.2);
  }
  to { 
    text-shadow: 
      0 0 30px rgba(255, 215, 0, 0.8),
      0 0 60px rgba(255, 215, 0, 0.6),
      0 0 90px rgba(255, 215, 0, 0.4),
      0 0 120px rgba(255, 215, 0, 0.2);
  }
}

.position-2nd {
  background: linear-gradient(135deg, #C0C0C0, #B0B0B0, #A0A0A0);
  -webkit-background-clip: text;
  background-clip: text;
  color: transparent;
  font-weight: 900;
  font-size: 3.5rem;
  font-family: 'Playfair Display', serif;
  text-shadow: 
    0 0 25px rgba(192, 192, 192, 0.5),
    0 0 50px rgba(192, 192, 192, 0.3);
  animation: silverGlow 3s infinite alternate;
}

@keyframes silverGlow {
  from { 
    text-shadow: 
      0 0 15px rgba(192, 192, 192, 0.6),
      0 0 30px rgba(192, 192, 192, 0.4),
      0 0 45px rgba(192, 192, 192, 0.2);
  }
  to { 
    text-shadow: 
      0 0 25px rgba(192, 192, 192, 0.8),
      0 0 50px rgba(192, 192, 192, 0.6),
      0 0 75px rgba(192, 192, 192, 0.4),
      0 0 100px rgba(192, 192, 192, 0.2);
  }
}

.position-3rd {
  background: linear-gradient(135deg, #CD7F32, #A0522D, #8B4513);
  -webkit-background-clip: text;
  background-clip: text;
  color: transparent;
  font-weight: 900;
  font-size: 3.2rem;
  font-family: 'Playfair Display', serif;
  text-shadow: 
    0 0 20px rgba(205, 127, 50, 0.5),
    0 0 40px rgba(205, 127, 50, 0.3);
  animation: bronzeGlow 3s infinite alternate;
}

@keyframes bronzeGlow {
  from { 
    text-shadow: 
      0 0 12px rgba(205, 127, 50, 0.6),
      0 0 24px rgba(205, 127, 50, 0.4),
      0 0 36px rgba(205, 127, 50, 0.2);
  }
  to { 
    text-shadow: 
      0 0 20px rgba(205, 127, 50, 0.8),
      0 0 40px rgba(205, 127, 50, 0.6),
      0 0 60px rgba(205, 127, 50, 0.4),
      0 0 80px rgba(205, 127, 50, 0.2);
  }
}

.position-pass {
  color: var(--success);
  font-weight: 900;
  font-size: 3rem;
  font-family: 'Playfair Display', serif;
  text-shadow: 
    2px 2px 4px rgba(0,0,0,0.1),
    0 0 20px rgba(76, 175, 80, 0.3);
  animation: passPulse 2s infinite;
}

@keyframes passPulse {
  0%, 100% { opacity: 1; transform: scale(1); }
  50% { opacity: 0.9; transform: scale(1.05); }
}

.absent { 
  color: var(--danger);
  font-weight: 900;
  font-size: 3rem;
  font-family: 'Montserrat', sans-serif;
  text-shadow: 
    2px 2px 4px rgba(0,0,0,0.1),
    0 0 20px rgba(244, 67, 54, 0.3);
  animation: pulse 2s infinite;
}

/* Responsive adjustments for VIP card */
@media (max-width: 1024px) {
  .vip-student-info h2 {
    font-size: 2.5rem;
  }
  
  .vip-position-badge {
    font-size: 1.8rem;
    padding: 15px 25px;
  }
  
  .vip-result-value {
    font-size: 3.2rem;
  }
  
  .position-1st {
    font-size: 3.2rem;
  }
  
  .position-2nd {
    font-size: 2.8rem;
  }
  
  .position-3rd {
    font-size: 2.5rem;
  }
}

@media (max-width: 768px) {
  .vip-result-display {
    padding: 35px 25px;
    margin: 30px 0;
  }
  
  .vip-header {
    flex-direction: column;
    text-align: center;
    gap: 25px;
  }
  
  .vip-student-info h2 {
    font-size: 2.2rem;
  }
  
  .vip-position-badge {
    font-size: 1.6rem;
    padding: 12px 20px;
  }
  
  .vip-results-grid {
    grid-template-columns: repeat(2, 1fr);
    gap: 20px;
  }
  
  .vip-result-value {
    font-size: 2.8rem;
  }
  
  .vip-remarks-content {
    font-size: 1.5rem;
    padding: 25px;
  }
  
  .vip-stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .position-1st, .position-2nd, .position-3rd {
    font-size: 2.5rem;
  }
}

@media (max-width: 480px) {
  .vip-results-grid {
    grid-template-columns: 1fr;
  }
  
  .vip-stats-grid {
    grid-template-columns: 1fr;
  }
  
  .vip-result-display {
    padding: 30px 20px;
  }
  
  .vip-student-info h2 {
    font-size: 1.8rem;
  }
  
  .vip-result-value {
    font-size: 2.5rem;
  }
  
  .vip-position-badge {
    font-size: 1.4rem;
    padding: 10px 18px;
  }
  
  .vip-remarks-content {
    font-size: 1.3rem;
    padding: 20px;
  }
  
  .vip-meta-item {
    font-size: 1rem;
    padding: 6px 12px;
  }
  
  .corner-decoration {
    width: 40px;
    height: 40px;
  }
}

/* Admin Remarks Section */
.remarks-section {
  background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
  border-radius: 16px;
  padding: 30px;
  margin-top: 40px;
  border-left: 6px solid var(--primary);
  animation: slideInRight 0.6s ease;
}

@keyframes slideInRight {
  from { opacity: 0; transform: translateX(20px); }
  to { opacity: 1; transform: translateX(0); }
}

.remarks-header {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 20px;
}

.remarks-header h3 {
  color: var(--primary);
  font-size: 1.8rem;
  margin: 0;
  font-family: 'Montserrat', sans-serif;
}

.remarks-content {
  font-size: 1.4rem;
  line-height: 1.8;
  color: var(--text);
  font-style: italic;
  background: white;
  padding: 25px;
  border-radius: 12px;
  border: 1px solid var(--border);
  box-shadow: 0 4px 15px rgba(46, 125, 50, 0.05);
  font-weight: 500;
  font-family: 'Playfair Display', serif;
}

.remarks-content.highlight {
  background: linear-gradient(135deg, #fff3cd, #ffeaa7);
  border-color: #ffc107;
}

/* Stats Cards */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 20px;
  margin: 30px 0;
}

.stat-card {
  background: white;
  padding: 25px;
  border-radius: 16px;
  text-align: center;
  box-shadow: 0 4px 15px rgba(46, 125, 50, 0.08);
  border: 1px solid var(--border);
  transition: all 0.3s ease;
}

.stat-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 25px rgba(46, 125, 50, 0.12);
}

.stat-icon {
  font-size: 2.5rem;
  margin-bottom: 15px;
  display: block;
}

.stat-label {
  color: var(--text-light);
  font-size: 0.95rem;
  margin-bottom: 10px;
  font-weight: 500;
}

.stat-value {
  font-size: 2.4rem;
  font-weight: 800;
  color: var(--primary);
  font-family: 'Montserrat', sans-serif;
}

/* Form Grid */
.form-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
  margin-bottom: 25px;
}

/* Attendance Controls */
.attendance-controls {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
  margin-bottom: 25px;
  background: white;
  padding: 25px;
  border-radius: 16px;
  box-shadow: var(--shadow);
}

/* Messages */
.message {
  padding: 15px 20px;
  border-radius: 12px;
  margin: 15px 0;
  font-weight: 500;
  border: 1px solid transparent;
  animation: slideInUp 0.5s ease;
}

@keyframes slideInUp {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

.message.success {
  background: #e8f5e9;
  color: #2e7d32;
  border-color: #c8e6c9;
}

.message.error {
  background: #ffebee;
  color: #c62828;
  border-color: #ffcdd2;
}

.message.info {
  background: #e3f2fd;
  color: #1565c0;
  border-color: #bbdefb;
}

/* Utility Classes */
.text-center { text-align: center; }
.mt-20 { margin-top: 20px; }
.mt-30 { margin-top: 30px; }
.mb-20 { margin-bottom: 20px; }
.mb-30 { margin-bottom: 30px; }
.p-20 { padding: 20px; }

/* Loading Spinner */
.spinner {
  border: 4px solid rgba(0, 0, 0, 0.1);
  border-left-color: var(--primary);
  border-radius: 50%;
  width: 40px;
  height: 40px;
  animation: spin 1s linear infinite;
  margin: 30px auto;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* RESPONSIVE DESIGN - MOBILE FRIENDLY */
@media (max-width: 1024px) {
  .student-info h3 {
    font-size: 2.2rem;
  }
  
  .position-1st, .position-2nd, .position-3rd {
    font-size: 2.5rem;
  }
  
  .result-value {
    font-size: 2.3rem;
  }
}

@media (max-width: 768px) {
  header {
    font-size: 1.5rem;
    padding: 1.2rem 1rem;
  }
  
  .subtitle {
    font-size: 0.9rem;
  }
  
  nav {
    padding: 0.5rem;
  }
  
  nav button {
    padding: 10px 16px;
    font-size: 0.9rem;
    min-width: 120px;
    flex: 0 0 calc(50% - 12px);
  }
  
  section {
    padding: 20px 15px;
  }
  
  .card {
    padding: 20px;
    margin: 15px 0;
  }
  
  .student-info h3 {
    font-size: 1.8rem;
  }
  
  .result-value {
    font-size: 2rem;
  }
  
  .remarks-content {
    font-size: 1.2rem;
    padding: 20px;
  }
  
  .results-grid {
    grid-template-columns: repeat(2, 1fr);
    gap: 15px;
  }
  
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
    gap: 15px;
  }
  
  .form-grid, .attendance-controls {
    grid-template-columns: 1fr;
    gap: 15px;
  }
  
  .result-display-card {
    padding: 25px;
    margin: 20px 0;
  }
  
  .result-header {
    flex-direction: column;
    text-align: center;
    gap: 15px;
  }
  
  .btn-group {
    flex-direction: column;
  }
  
  .btn-group button {
    width: 100%;
  }
}

@media (max-width: 480px) {
  nav button {
    flex: 0 0 100%;
    min-width: 100px;
    padding: 8px 12px;
    font-size: 0.85rem;
  }
  
  .student-info h3 {
    font-size: 1.6rem;
  }
  
  .position-1st, .position-2nd, .position-3rd {
    font-size: 2rem;
  }
  
  .result-value {
    font-size: 1.8rem;
  }
  
  .results-grid {
    grid-template-columns: 1fr;
  }
  
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .form-grid, .attendance-controls {
    grid-template-columns: 1fr;
  }
  
  .result-item {
    padding: 20px;
  }
  
  .table-container {
    margin: 15px -15px;
    width: calc(100% + 30px);
  }
  
  .card-header {
    flex-direction: column;
    text-align: center;
    gap: 10px;
  }
}

@media (max-width: 360px) {
  header {
    font-size: 1.3rem;
    padding: 1rem 0.8rem;
  }
  
  .logo-container span {
    font-size: 2rem;
  }
  
  .stats-grid {
    grid-template-columns: 1fr;
  }
  
  .result-display-card {
    padding: 20px 15px;
  }
  
  .result-item h4 {
    font-size: 1rem;
  }
  
  .result-value {
    font-size: 1.6rem;
  }
}

/* No Results Message */
.no-results {
  text-align: center;
  padding: 50px 20px;
  color: var(--text-light);
  font-style: italic;
  font-size: 1.2rem;
}

.no-results span {
  font-size: 3rem;
  display: block;
  margin-bottom: 20px;
  opacity: 0.5;
}

/* Delete confirmation styles */
.confirmation-dialog {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: white;
  padding: 30px;
  border-radius: 20px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.3);
  z-index: 2000;
  text-align: center;
  max-width: 90%;
  width: 500px;
  animation: popIn 0.4s ease;
}

@keyframes popIn {
  from { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
  to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
}

.overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.7);
  z-index: 1999;
  backdrop-filter: blur(5px);
}

/* Custom Scrollbar */
::-webkit-scrollbar {
  width: 10px;
}

::-webkit-scrollbar-track {
  background: #f1f1f1;
  border-radius: 5px;
}

::-webkit-scrollbar-thumb {
  background: var(--primary);
  border-radius: 5px;
}

::-webkit-scrollbar-thumb:hover {
  background: var(--primary-dark);
}

/* Print Styles */
@media print {
  nav, .btn, .confirmation-dialog, .overlay {
    display: none !important;
  }
  
  .result-display-card {
    box-shadow: none;
    border: 3px solid #000;
  }
  
  .result-value {
    font-size: 2rem;
  }
}
</style>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Montserrat:wght@600;800&display=swap" rel="stylesheet">
</head>
<body>

<header>
  <div class="logo-container">
    <span>üïå</span>
    <div>
      <div>Faizan-e-Raza Madarsa Result Portal</div>
      <div class="subtitle">Academic Excellence Management System</div>
    </div>
  </div>
</header>

<nav>
  <button onclick="showSection('resultSection')">
    <span>üìä</span> Check Result
  </button>
  <button id="loginBtn" onclick="showSection('loginSection')">
    <span>üîê</span> Admin Login
  </button>
  <button id="studentBtn" class="hidden" onclick="showSection('studentSection')">
    <span>üë®‚Äçüéì</span> Student Management
  </button>
  <button id="attendanceBtn" class="hidden" onclick="showSection('attendanceSection')">
    <span>üìù</span> Attendance
  </button>
  <button id="resultBtn" class="hidden" onclick="showSection('addResultSection')">
    <span>üìà</span> Add Results
  </button>
  <button id="allResultBtn" class="hidden" onclick="showSection('allResultsSection')">
    <span>üìã</span> All Results
  </button>
  <button id="changeCodeBtn" class="hidden" onclick="showSection('changeCodeSection')">
    <span>‚öôÔ∏è</span> Settings
  </button>
  <button id="logoutBtn" class="hidden" onclick="adminLogout()">
    <span>üö™</span> Logout
  </button>
</nav>

<!-- üü¢ PUBLIC RESULT CHECK -->
<section id="resultSection" class="active">
  <div class="card">
    <div class="card-header">
      <span>üìä</span>
      <h2>Check Student Result</h2>
    </div>
    <div class="form-grid">
      <div>
        <label for="searchRoll">Enter Roll Number</label>
        <input type="text" id="searchRoll" placeholder="e.g., 1001, 1002">
      </div>
    </div>
    <button class="btn" onclick="checkResult()">
      <span>üîç</span> Check Result
    </button>
    <div id="resultOutput" class="mt-30"></div>
  </div>
</section>

<!-- üîê ADMIN LOGIN -->
<section id="loginSection">
  <div class="card">
    <div class="card-header">
      <span>üîê</span>
      <h2>Admin Login</h2>
    </div>
    <div class="form-grid">
      <div>
        <label for="adminCode">Admin Password</label>
        <input type="password" id="adminCode" placeholder="Enter admin code">
      </div>
    </div>
    <button class="btn" onclick="adminLogin()">
      <span>üöÄ</span> Login to Dashboard
    </button>
    <p id="loginMsg" class="message mt-20"></p>
  </div>
</section>

<!-- üßë‚Äçüéì STUDENT MANAGEMENT -->
<section id="studentSection">
  <div class="card">
    <div class="card-header">
      <span>üë®‚Äçüéì</span>
      <h2>Student Management</h2>
    </div>
    
    <!-- Stats Overview -->
    <div class="stats-grid">
      <div class="stat-card">
        <span class="stat-icon">üìä</span>
        <div class="stat-label">Total Students</div>
        <div class="stat-value vip-font-bold" id="totalStudentsCount">0</div>
      </div>
      <div class="stat-card">
        <span class="stat-icon">üìö</span>
        <div class="stat-label">Noorani Qaida</div>
        <div class="stat-value vip-font-bold" id="qaidaCount">0</div>
      </div>
      <div class="stat-card">
        <span class="stat-icon">üìñ</span>
        <div class="stat-label">Separa</div>
        <div class="stat-value vip-font-bold" id="separaLcount">0</div>
      </div>
      
    </div>
    
    <!-- Add Student Form -->
    <div class="card mt-30">
      <div class="card-header">
        <span>‚ûï</span>
        <h3>Add New Student</h3>
      </div>
      <div class="form-grid">
        <div>
          <label>Student Name *</label>
          <input type="text" id="nameInput" placeholder="Full name">
        </div>
        <div>
          <label>Roll Number *</label>
          <input type="text" id="rollInput" placeholder="Unique roll number">
        </div>
        <div>
          <label>Class *</label>
          <select id="categoryInput">
            <option value="">Select Class</option>
            <option>Noorani Qaida</option>
            <option>Separa</option>
          </select>
        </div>
      </div>
      <div class="btn-group">
        <button class="btn-success" onclick="addStudent()">
          <span>‚úÖ</span> Add Student
        </button>
        <button class="btn" onclick="loadAllStudents()">
          <span>üîÑ</span> Refresh List
        </button>
      </div>
      <p id="stdMsg" class="message mt-20"></p>
    </div>
    
    <!-- Student List -->
    <div class="card mt-30">
      <div class="card-header">
        <span>üìã</span>
        <h3>All Students List</h3>
      </div>
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>#</th>
              <th>Roll Number</th>
              <th>Student Name</th>
              <th>Class</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="allStudentsTable">
            <tr><td colspan="5" class="text-center">Loading students...</td></tr>
          </tbody>
        </table>
      </div>
    </div>
    
    <!-- Exit Student -->
    <div class="card mt-30" style="border-left: 6px solid var(--danger);">
      <div class="card-header">
        <span>üö™</span>
        <h3>Exit Student</h3>
      </div>
      <div class="form-grid">
        <div>
          <label>Roll Number *</label>
          <input type="text" id="exitRoll" placeholder="Student roll number">
        </div>
        <div>
          <label>Exit Date *</label>
          <input type="date" id="exitDate">
        </div>
        <div>
          <label>Reason for Exit *</label>
          <input type="text" id="exitReason" placeholder="Reason for leaving">
        </div>
      </div>
      <button class="btn-danger" onclick="exitStudent()">
        <span>‚ùå</span> Exit Student
      </button>
      <p id="exitMsg" class="message mt-20"></p>
    </div>
  </div>
</section>


<!-- üìù ATTENDANCE -->
<section id="attendanceSection">
  <div class="card">
    <div class="card-header">
      <span>üìù</span>
      <h2>Daily Attendance</h2>
    </div>
    
    <div class="attendance-controls">
      <div>
        <label>Select Date</label>
        <input type="date" id="attendanceDate" value="">
      </div>
      <div>
        <label>Class Filter</label>
        <select id="attendanceClassFilter">
          <option value="">All Classes</option>
          <option>Noorani Qaida</option>
          <option>Separa</option>
          <option>Nazra</option>
          <option>Hifz</option>
        </select>
      </div>
    </div>
    
    <div class="btn-group">
      <button class="btn" onclick="loadAttendanceStudents()">
        <span>üë•</span> Load Students
      </button>
      <button class="btn-success" onclick="markAllPresent()">
        <span>‚úÖ</span> Mark All Present
      </button>
      <button class="btn-warning" onclick="markAllAbsent()">
        <span>‚ùå</span> Mark All Absent
      </button>
    </div>
    
    <div id="attendanceTableContainer" class="mt-30"></div>
    
    <div id="attendanceSummary" class="card mt-30 hidden">
      <div class="card-header">
        <span>üìä</span>
        <h3>Attendance Summary</h3>
      </div>
      <div class="stats-grid">
        <div class="stat-card">
          <span class="stat-icon">‚úÖ</span>
          <div class="stat-label">Present</div>
          <div class="stat-value vip-font-bold" id="presentCount">0</div>
        </div>
        <div class="stat-card">
          <span class="stat-icon">‚ùå</span>
          <div class="stat-label">Absent</div>
          <div class="stat-value vip-font-bold" id="absentCount">0</div>
        </div>
        <div class="stat-card">
          <span class="stat-icon">üèñÔ∏è</span>
          <div class="stat-label">Holiday</div>
          <div class="stat-value vip-font-bold" id="holidayCount">0</div>
        </div>
        <div class="stat-card">
          <span class="stat-icon">üë•</span>
          <div class="stat-label">Total</div>
          <div class="stat-value vip-font-bold" id="totalCount">0</div>
        </div>
      </div>
      <button class="btn" onclick="saveAttendance()">
        <span>üíæ</span> Save Attendance
      </button>
      <p id="attendanceMsg" class="message mt-20"></p>
    </div>
    
    <!-- Delete Attendance -->
    <div class="card mt-30" style="border-left: 6px solid var(--danger);">
      <div class="card-header">
        <span>üóëÔ∏è</span>
        <h3>Delete Attendance Records</h3>
      </div>
      <p><strong>Warning:</strong> These actions cannot be undone!</p>
      <div class="attendance-controls mt-20">
        <div>
          <label>Select Date to Delete</label>
          <input type="date" id="deleteAttendanceDate">
        </div>
      </div>
      <div class="btn-group mt-20">
        <button class="btn-danger" onclick="deleteSingleAttendance()">
          <span>üóëÔ∏è</span> Delete Selected Date
        </button>
        <button class="btn-danger" onclick="deleteAllAttendance()">
          <span>üî•</span> Delete All Attendance
        </button>
      </div>
      <p id="deleteAttendanceMsg" class="message mt-20"></p>
    </div>
  </div>
</section>

<!-- üìà ADD RESULTS -->
<section id="addResultSection">
  <div class="card">
    <div class="card-header">
      <span>üìà</span>
      <h2>Add Monthly Results</h2>
    </div>
    
    <div class="message info">
      <strong>‚ÑπÔ∏è Auto Attendance Import</strong>
      <p>Attendance data will be automatically imported from the selected month's attendance records.</p>
    </div>
    
    <div class="form-grid mt-30">
      <div>
        <label>Month *</label>
        <input type="text" id="monthInput" placeholder="e.g., October, November">
      </div>
    </div>
    
    <div class="card mt-30">
      <div class="card-header">
        <span>üìä</span>
        <h3>Set Total Marks</h3>
      </div>
      <div class="form-grid">
        <input type="number" id="namazTotal" placeholder="Namaz Total Marks">
        <input type="number" id="kalmaTotal" placeholder="Kalma Total Marks">
        <input type="number" id="quranTotal" placeholder="Nazra Total Marks">
      </div>
    </div>
    
    <div class="card mt-30">
      <div class="card-header">
        <span>üìÖ</span>
        <h3>Set Total Working Days</h3>
      </div>
      <input type="number" id="totalWorkingDays" placeholder="Total working days in month" required>
    </div>
    
    <div class="card mt-30" style="background: #fff3cd; border-color: #ffc107;">
      <div class="card-header">
        <span>üí∞</span>
        <h3>Fine Calculation</h3>
      </div>
      <p><strong>‚Çπ10 per absent day will be automatically calculated</strong></p>
      <p>Fine = (Total Working Days - Present Days) √ó ‚Çπ10</p>
    </div>
    
    <div class="btn-group mt-30">
      <button class="btn" onclick="loadStudentsForResults()">
        <span>üë•</span> Load Students with Auto Attendance
      </button>
    </div>
    
    <div id="resultTableContainer" class="mt-30"></div>
    
    <div class="btn-group mt-30">
      <button class="btn-success" onclick="saveAllResults()">
        <span>üíæ</span> Save All Results
      </button>
    </div>
    
    <p id="resMsg" class="message mt-20"></p>
  </div>
</section>

<!-- üìã ALL RESULTS -->
<section id="allResultsSection">
  <div class="card">
    <div class="card-header">
      <span>üìã</span>
      <h2>All Results</h2>
    </div>
    
    <div class="btn-group">
      <button class="btn" onclick="loadAllResults()">
        <span>üîÑ</span> Refresh Results
      </button>
      <button class="btn-danger" onclick="showDeleteConfirmation()">
        <span>üóëÔ∏è</span> Delete All Results
      </button>
    </div>
    
    <div id="defaultResultsView" class="mt-30">
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>#</th>
              <th>Roll</th>
              <th>Name</th>
              <th>Class</th>
              <th>Month</th>
              <th>Total</th>
              <th>Attendance</th>
              <th>Position</th>
              <th>Fine</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="allResultsTable">
            <tr><td colspan="10" class="text-center">Loading results...</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</section>

<!-- ‚öôÔ∏è SETTINGS -->
<section id="changeCodeSection">
  <div class="card">
    <div class="card-header">
      <span>‚öôÔ∏è</span>
      <h2>System Settings</h2>
    </div>
    
    <div class="card mt-30">
      <div class="card-header">
        <span>üîê</span>
        <h3>Change Admin Password</h3>
      </div>
      <div class="form-grid">
        <div>
          <label>Current Password</label>
          <input type="password" id="oldCode" placeholder="Enter current password">
        </div>
        <div>
          <label>New Password</label>
          <input type="password" id="newCode" placeholder="Enter new password">
        </div>
      </div>
      <button class="btn" onclick="changeAdminCode()">
        <span>üîÑ</span> Change Password
      </button>
      <p id="codeMsg" class="message mt-20"></p>
    </div>
    
    <div class="card mt-30">
      <div class="card-header">
        <span>üìù</span>
        <h3>Add Remarks for Students</h3>
      </div>
      <div class="form-grid">
        <div>
          <label>Select Student</label>
          <select id="remarkStudentSelect" onchange="loadStudentRemark()">
            <option value="">Select student...</option>
          </select>
        </div>
      </div>
      <div id="remarkFormContainer"></div>
      <p id="remarkMsg" class="message mt-20"></p>
    </div>
  </div>
</section>

<!-- JavaScript will be added below -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getDatabase, ref, set, get, child, remove, update } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDp8fdbDJRs17iFgcj1lN1YAmhiWccEkuc",
  authDomain: "result-app-8cdd1.firebaseapp.com",
  databaseURL: "https://result-app-8cdd1-default-rtdb.firebaseio.com",
  projectId: "result-app-8cdd1",
  storageBucket: "result-app-8cdd1.firebasestorage.app",
  messagingSenderId: "1000820695282",
  appId: "1:1000820695282:web:82a4f0ee1e51de2305f06b"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// ‚úÖ Set initial admin code to 1300
const adminRef = ref(db, "admin/code");
get(adminRef).then(snap => { 
  if (!snap.exists()) {
    set(adminRef, "1300");
  }
});

// Navigation
window.showSection = (id) => {
  document.querySelectorAll("section").forEach(s => s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
  
  // Load data when section is shown
  if (id === 'studentSection') {
    updateTotalStudentsCount();
    loadAllStudents();
  }
  
  if (id === 'allResultsSection') {
    loadAllResults();
  }
  
  if (id === 'changeCodeSection') {
    loadStudentsForRemarks();
  }
};

// üîê Admin Login
window.adminLogin = async () => {
  const code = document.getElementById('adminCode').value.trim();
  const snap = await get(ref(db, "admin/code"));
  const realCode = snap.exists() ? snap.val() : "1300";
  
  if (code === realCode) {
    // Show admin buttons
    document.querySelectorAll("#studentBtn, #logoutBtn, #resultBtn, #allResultBtn, #changeCodeBtn, #attendanceBtn")
      .forEach(b => b.classList.remove("hidden"));
    document.getElementById("loginBtn").classList.add("hidden");
    
    document.getElementById("loginMsg").textContent = "‚úÖ Login Successful! Redirecting...";
    document.getElementById("loginMsg").className = "message success";
    
    setTimeout(() => {
      showSection("studentSection");
    }, 1000);
    
  } else {
    document.getElementById("loginMsg").textContent = "‚ùå Incorrect password!";
    document.getElementById("loginMsg").className = "message error";
  }
};

// Logout
window.adminLogout = () => {
  document.querySelectorAll("#studentBtn, #logoutBtn, #resultBtn, #allResultBtn, #changeCodeBtn, #attendanceBtn")
    .forEach(b => b.classList.add("hidden"));
  document.getElementById("loginBtn").classList.remove("hidden");
  showSection("resultSection");
};

// Update total students count
async function updateTotalStudentsCount() {
  try {
    const snap = await get(child(ref(db), "students"));
    let totalCount = 0;
    let qaidaCount = 0;
    let separaCount = 0;
    let nazraCount = 0;
    let hifzCount = 0;
    
    if (snap.exists()) {
      snap.forEach((child) => {
        const student = child.val();
        totalCount++;
        
        switch(student.category) {
          case 'Noorani Qaida':
            qaidaCount++;
            break;
          case 'Separa':
            separaCount++;
            break;
          case 'Nazra':
            nazraCount++;
            break;
          case 'Hifz':
            hifzCount++;
            break;
        }
      });
    }
    
    // Update display in student section
    document.getElementById('totalStudentsCount').textContent = totalCount;
    document.getElementById('qaidaCount').textContent = qaidaCount;
    document.getElementById('separaLcount').textContent = separaCount;
    document.getElementById('nazraCount').textContent = nazraCount;
    document.getElementById('hifzCount').textContent = hifzCount;
    
  } catch (error) {
    console.error("Error updating student count:", error);
  }
}

// Load All Students
window.loadAllStudents = async () => {
  try {
    const snap = await get(child(ref(db), "students"));
    const tbody = document.getElementById('allStudentsTable');
    
    if (!snap.exists()) {
      tbody.innerHTML = `<tr><td colspan="5" class="text-center">No students found. Add your first student!</td></tr>`;
      updateTotalStudentsCount();
      return;
    }
    
    let html = '';
    let count = 1;
    const students = [];
    
    snap.forEach(child => {
      students.push(child.val());
    });
    
    // Sort students by roll number
    students.sort((a, b) => a.roll.localeCompare(b.roll, undefined, {numeric: true}));
    
    students.forEach(student => {
      html += `
        <tr>
          <td>${count}</td>
          <td><strong>${student.roll}</strong></td>
          <td>${student.name}</td>
          <td><span class="btn-info" style="padding: 4px 12px; font-size: 0.85rem;">${student.category}</span></td>
          <td>
            <button class="btn-danger" onclick="deleteStudent('${student.roll}')" style="padding: 6px 12px; font-size: 0.85rem;">
              üóë Delete
            </button>
          </td>
        </tr>
      `;
      count++;
    });
    
    tbody.innerHTML = html;
    updateTotalStudentsCount();
    
  } catch (error) {
    console.error("Error loading students:", error);
    document.getElementById('allStudentsTable').innerHTML = `<tr><td colspan="5" class="text-center">Error loading students</td></tr>`;
  }
};

// Add Student
window.addStudent = async () => {
  const name = document.getElementById('nameInput').value.trim();
  const roll = document.getElementById('rollInput').value.trim();
  const category = document.getElementById('categoryInput').value;
  
  if (!name || !roll || !category) {
    document.getElementById('stdMsg').textContent = "‚ö† Please fill all required fields!";
    document.getElementById('stdMsg').className = "message error";
    return;
  }
  
  try {
    // Check if roll number already exists
    const existingStudent = await get(ref(db, "students/" + roll));
    if (existingStudent.exists()) {
      document.getElementById('stdMsg').textContent = "‚ùå Roll number already exists!";
      document.getElementById('stdMsg').className = "message error";
      return;
    }
    
    // Add student to database
    await set(ref(db, "students/" + roll), {
      name: name,
      roll: roll,
      category: category
    });
    
    document.getElementById('stdMsg').textContent = "‚úÖ Student added successfully!";
    document.getElementById('stdMsg').className = "message success";
    
    // Clear form
    document.getElementById('nameInput').value = '';
    document.getElementById('rollInput').value = '';
    document.getElementById('categoryInput').value = '';
    
    // Reload student list
    loadAllStudents();
    
  } catch (error) {
    document.getElementById('stdMsg').textContent = "‚ùå Error adding student: " + error.message;
    document.getElementById('stdMsg').className = "message error";
  }
};

// Delete Student
window.deleteStudent = async (roll) => {
  if (!confirm(`Are you sure you want to delete student with roll number ${roll}?`)) {
    return;
  }
  
  try {
    // Delete student
    await remove(ref(db, "students/" + roll));
    
    // Delete student's results
    const resultsSnap = await get(child(ref(db), "results"));
    if (resultsSnap.exists()) {
      const deletePromises = [];
      resultsSnap.forEach(c => {
        const result = c.val();
        if (result.roll === roll) {
          deletePromises.push(remove(ref(db, "results/" + c.key)));
        }
      });
      await Promise.all(deletePromises);
    }
    
    // Reload student list
    loadAllStudents();
    
  } catch (error) {
    alert("‚ùå Error deleting student: " + error.message);
  }
};

// Exit Student
window.exitStudent = async () => {
  const roll = document.getElementById('exitRoll').value.trim();
  const date = document.getElementById('exitDate').value;
  const reason = document.getElementById('exitReason').value.trim();
  
  if (!roll || !date || !reason) {
    document.getElementById('exitMsg').textContent = "‚ö† Please fill all fields!";
    document.getElementById('exitMsg').className = "message error";
    return;
  }
  
  try {
    // Get student data
    const studentSnap = await get(ref(db, "students/" + roll));
    if (!studentSnap.exists()) {
      document.getElementById('exitMsg').textContent = "‚ùå Student not found!";
      document.getElementById('exitMsg').className = "message error";
      return;
    }
    
    const student = studentSnap.val();
    
    // Add to exited students
    await set(ref(db, "exited/" + roll), {
      roll: roll,
      name: student.name,
      date: date,
      reason: reason,
      exitedAt: new Date().toISOString()
    });
    
    // Remove from active students
    await remove(ref(db, "students/" + roll));
    
    document.getElementById('exitMsg').textContent = "‚úÖ Student exited successfully!";
    document.getElementById('exitMsg').className = "message success";
    
    // Clear form
    document.getElementById('exitRoll').value = '';
    document.getElementById('exitDate').value = '';
    document.getElementById('exitReason').value = '';
    
    // Reload student list
    loadAllStudents();
    
  } catch (error) {
    document.getElementById('exitMsg').textContent = "‚ùå Error exiting student: " + error.message;
    document.getElementById('exitMsg').className = "message error";
  }
};

// ===================
// ATTENDANCE FUNCTIONS
// ===================

// Load students for attendance
window.loadAttendanceStudents = async () => {
  const date = document.getElementById('attendanceDate').value;
  const classFilter = document.getElementById('attendanceClassFilter').value;
  
  // Set default date to today if not selected
  if (!date) {
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('attendanceDate').value = today;
  }
  
  const currentDate = document.getElementById('attendanceDate').value;
  
  if (!currentDate) {
    alert("‚ö† Please select a date!");
    return;
  }
  
  try {
    const snap = await get(child(ref(db), "students"));
    const container = document.getElementById('attendanceTableContainer');
    
    if (!snap.exists()) {
      container.innerHTML = "<div class='no-results'><span>üë•</span><p>No students found</p></div>";
      return;
    }
    
    // Load existing attendance for this date
    let existingAttendance = {};
    const attendanceSnap = await get(ref(db, `attendance/${currentDate.replace(/-/g, '_')}`));
    if (attendanceSnap.exists()) {
      attendanceSnap.forEach(child => {
        const student = child.val();
        existingAttendance[student.roll] = student.status;
      });
    }
    
    let html = `
      <div class="card">
        <div class="card-header">
          <span>üìÖ</span>
          <h3>Attendance for ${currentDate}</h3>
        </div>
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>#</th>
                <th>Roll</th>
                <th>Name</th>
                <th>Class</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
    `;
    
    let count = 1;
    const students = [];
    
    snap.forEach(child => {
      students.push(child.val());
    });
    
    // Sort students by roll number
    students.sort((a, b) => a.roll.localeCompare(b.roll, undefined, {numeric: true}));
    
    students.forEach(student => {
      // Apply class filter
      if (classFilter && student.category !== classFilter) {
        return;
      }
      
      const existingStatus = existingAttendance[student.roll] || 'present';
      const statusId = `status_${student.roll}`;
      
      html += `
        <tr>
          <td>${count}</td>
          <td><strong>${student.roll}</strong></td>
          <td>${student.name}</td>
          <td>${student.category}</td>
          <td>
            <select id="${statusId}" class="attendance-status" style="padding: 8px; border-radius: 8px; border: 2px solid var(--border); width: 120px;" onchange="updateAttendanceSummary()">
              <option value="present" ${existingStatus === 'present' ? 'selected' : ''}>‚úÖ Present</option>
              <option value="absent" ${existingStatus === 'absent' ? 'selected' : ''}>‚ùå Absent</option>
              <option value="holiday" ${existingStatus === 'holiday' ? 'selected' : ''}>üèñÔ∏è Holiday</option>
            </select>
          </td>
        </tr>
      `;
      count++;
    });
    
    html += "</tbody></table></div></div>";
    container.innerHTML = html;
    
    // Show attendance summary
    document.getElementById('attendanceSummary').classList.remove('hidden');
    updateAttendanceSummary();
    
  } catch (error) {
    console.error("Error loading attendance students:", error);
    container.innerHTML = `<div class="message error">‚ùå Error loading attendance: ${error.message}</div>`;
  }
};

// Mark all students as present
window.markAllPresent = () => {
  document.querySelectorAll('.attendance-status').forEach(select => {
    select.value = 'present';
  });
  updateAttendanceSummary();
};

// Mark all students as absent
window.markAllAbsent = () => {
  document.querySelectorAll('.attendance-status').forEach(select => {
    select.value = 'absent';
  });
  updateAttendanceSummary();
};

// Update attendance summary
window.updateAttendanceSummary = () => {
  const presentSelects = document.querySelectorAll('.attendance-status');
  let presentCount = 0;
  let absentCount = 0;
  let holidayCount = 0;
  let totalCount = 0;
  
  presentSelects.forEach(select => {
    totalCount++;
    if (select.value === 'present') {
      presentCount++;
    } else if (select.value === 'absent') {
      absentCount++;
    } else if (select.value === 'holiday') {
      holidayCount++;
    }
  });
  
  document.getElementById('presentCount').textContent = presentCount;
  document.getElementById('absentCount').textContent = absentCount;
  document.getElementById('holidayCount').textContent = holidayCount;
  document.getElementById('totalCount').textContent = totalCount;
};

// Save attendance
window.saveAttendance = async () => {
  const date = document.getElementById('attendanceDate').value;
  const classFilter = document.getElementById('attendanceClassFilter').value;
  
  if (!date) {
    alert("‚ö† Please select a date!");
    return;
  }
  
  try {
    const snap = await get(child(ref(db), "students"));
    const attendanceData = [];
    
    if (!snap.exists()) {
      alert("‚ùå No students found!");
      return;
    }
    
    snap.forEach(child => {
      const student = child.val();
      
      // Apply class filter
      if (classFilter && student.category !== classFilter) {
        return;
      }
      
      const status = document.getElementById(`status_${student.roll}`)?.value || 'absent';
      
      attendanceData.push({
        roll: student.roll,
        name: student.name,
        class: student.category,
        status: status,
        date: date,
        timestamp: new Date().toISOString()
      });
    });
    
    // Save to Firebase
    const attendanceRef = ref(db, `attendance/${date.replace(/-/g, '_')}`);
    await set(attendanceRef, attendanceData);
    
    document.getElementById('attendanceMsg').textContent = "‚úÖ Attendance saved successfully!";
    document.getElementById('attendanceMsg').className = "message success";
    
    // Clear message after 2 seconds
    setTimeout(() => {
      document.getElementById('attendanceMsg').textContent = '';
      document.getElementById('attendanceMsg').className = '';
    }, 2000);
    
  } catch (error) {
    console.error("Error saving attendance:", error);
    document.getElementById('attendanceMsg').textContent = "‚ùå Error saving attendance: " + error.message;
    document.getElementById('attendanceMsg').className = "message error";
  }
};

// Delete single attendance record
window.deleteSingleAttendance = async () => {
  const date = document.getElementById('deleteAttendanceDate').value;
  
  if (!date) {
    document.getElementById('deleteAttendanceMsg').textContent = "‚ö† Please select a date to delete!";
    document.getElementById('deleteAttendanceMsg').className = "message error";
    return;
  }
  
  if (!confirm(`Are you sure you want to delete attendance for ${date}?`)) {
    return;
  }
  
  try {
    const formattedDate = date.replace(/-/g, '_');
    await remove(ref(db, `attendance/${formattedDate}`));
    
    document.getElementById('deleteAttendanceMsg').textContent = "‚úÖ Attendance deleted successfully!";
    document.getElementById('deleteAttendanceMsg').className = "message success";
    
    // Clear form
    document.getElementById('deleteAttendanceDate').value = '';
    
  } catch (error) {
    document.getElementById('deleteAttendanceMsg').textContent = "‚ùå Error deleting attendance: " + error.message;
    document.getElementById('deleteAttendanceMsg').className = "message error";
  }
};

// Delete all attendance
window.deleteAllAttendance = async () => {
  if (!confirm("‚ö† Are you sure you want to delete ALL attendance records? This action cannot be undone!")) {
    return;
  }
  
  try {
    await remove(ref(db, "attendance"));
    
    document.getElementById('deleteAttendanceMsg').textContent = "‚úÖ All attendance records deleted successfully!";
    document.getElementById('deleteAttendanceMsg').className = "message success";
    
    // Clear form
    document.getElementById('deleteAttendanceDate').value = '';
    
  } catch (error) {
    document.getElementById('deleteAttendanceMsg').textContent = "‚ùå Error deleting attendance: " + error.message;
    document.getElementById('deleteAttendanceMsg').className = "message error";
  }
};

// ===================
// RESULTS FUNCTIONS
// ===================

// Load students for results with auto attendance import
window.loadStudentsForResults = async () => {
  const month = document.getElementById('monthInput').value.trim();
  const totalWorkingDays = document.getElementById('totalWorkingDays').value;
  
  if(!month) {
    alert("‚ö† Please enter month first!");
    return;
  }
  
  if(!totalWorkingDays) {
    alert("‚ö† Please enter Total Working Days first!");
    return;
  }

  try {
    // Get all students
    const snap = await get(child(ref(db), "students"));
    const container = document.getElementById('resultTableContainer');
    
    if(!snap.exists()) {
      container.innerHTML = "<div class='no-results'><span>üë•</span><p>No students found</p></div>";
      return;
    }
    
    // Get attendance data for the selected month
    const attendanceSnap = await get(child(ref(db), "attendance"));
    const monthlyAttendance = {};
    
    if (attendanceSnap.exists()) {
      attendanceSnap.forEach(dateSnap => {
        const date = dateSnap.key.replace(/_/g, '-');
        const dateObj = new Date(date);
        const monthName = dateObj.toLocaleString('default', { month: 'long' });
        
        if (monthName === month) {
          dateSnap.forEach(child => {
            const student = child.val();
            if (!monthlyAttendance[student.roll]) {
              monthlyAttendance[student.roll] = {
                present: 0,
                absent: 0
              };
            }
            
            if (student.status === 'present') {
              monthlyAttendance[student.roll].present++;
            } else if (student.status === 'absent') {
              monthlyAttendance[student.roll].absent++;
            }
          });
        }
      });
    }
    
    let html = `
      <div class="card">
        <div class="card-header">
          <span>üìù</span>
          <h3>Enter Marks for ${month}</h3>
        </div>
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>#</th>
                <th>Roll</th>
                <th>Name</th>
                <th>Class</th>
                <th>Namaz</th>
                <th>Kalma</th>
                <th>Nazra</th>
                <th>Present Days (Auto)</th>
                <th>Auto Fine (‚Çπ10/day)</th>
                <th>Position</th>
              </tr>
            </thead>
            <tbody>
    `;
    
    let count = 1;
    const students = [];
    
    snap.forEach(child => {
      students.push(child.val());
    });
    
    // Sort students by roll number
    students.sort((a, b) => a.roll.localeCompare(b.roll, undefined, {numeric: true}));
    
    students.forEach(student => {
      const namazTotal = document.getElementById('namazTotal').value || 100;
      const kalmaTotal = document.getElementById('kalmaTotal').value || 100;
      const quranTotal = document.getElementById('quranTotal').value || 100;
      
      // Get auto attendance data
      const attendanceData = monthlyAttendance[student.roll] || { present: 0, absent: 0 };
      const presentDays = attendanceData.present;
      const absentDays = +totalWorkingDays - presentDays;
      const autoFine = absentDays > 0 ? absentDays * 10 : 0;
      
      html += `<tr>
        <td>${count}</td>
        <td><strong>${student.roll}</strong></td>
        <td>${student.name}</td>
        <td>${student.category}</td>
        <td><input type='number' id='n_${student.roll}' placeholder='0' min='0' max='${namazTotal}' value='0' style="width: 80px; padding: 8px; border-radius: 8px; border: 2px solid var(--border);"></td>
        <td><input type='number' id='k_${student.roll}' placeholder='0' min='0' max='${kalmaTotal}' value='0' style="width: 80px; padding: 8px; border-radius: 8px; border: 2px solid var(--border);"></td>
        <td><input type='number' id='q_${student.roll}' placeholder='0' min='0' max='${quranTotal}' value='0' style="width: 80px; padding: 8px; border-radius: 8px; border: 2px solid var(--border);"></td>
        <td>
          <input type='number' id='a_${student.roll}' value='${presentDays}' min='0' max='${totalWorkingDays}' style="width: 100px; padding: 8px; border-radius: 8px; border: 2px solid var(--border);" onchange="calculateAutoFine('${student.roll}')">
          <br><small style="color: var(--text-light); font-size: 0.85rem;">Auto: ${presentDays} days</small>
        </td>
        <td><span id='autoFine_${student.roll}' style="font-weight: bold; color: var(--danger);">‚Çπ ${autoFine}</span></td>
        <td>
          <select id='p_${student.roll}' style="padding: 8px; border-radius: 8px; border: 2px solid var(--border); width: 100px;">
            <option value=''>Select</option>
            <option value='1st'>ü•á 1st</option>
            <option value='2nd'>ü•à 2nd</option>
            <option value='3rd'>ü•â 3rd</option>
            <option value='Pass'>‚úÖ Pass</option>
          </select>
        </td>
      </tr>`;
      count++;
    });
    
    html += "</tbody></table></div></div>";
    container.innerHTML = html;
    
  } catch (error) {
    console.error("Error loading students for results:", error);
    container.innerHTML = `<div class="message error">‚ùå Error loading students: ${error.message}</div>`;
  }
};

// Calculate automatic fine
window.calculateAutoFine = (roll) => {
  const totalWorkingDays = +document.getElementById('totalWorkingDays').value;
  const presentDays = +document.getElementById('a_' + roll).value || 0;
  const absentDays = totalWorkingDays - presentDays;
  const autoFine = absentDays > 0 ? absentDays * 10 : 0;
  
  document.getElementById('autoFine_' + roll).innerHTML = `‚Çπ ${autoFine}`;
};

// Save Results (month-wise) with auto attendance
window.saveAllResults = async () => {
  const month = document.getElementById('monthInput').value.trim();
  if(!month) {
    document.getElementById('resMsg').textContent = "‚ö† Enter month!";
    document.getElementById('resMsg').className = "message error";
    return;
  }
  
  const nT = +document.getElementById('namazTotal').value || 0;
  const kT = +document.getElementById('kalmaTotal').value || 0;
  const qT = +document.getElementById('quranTotal').value || 0;
  const totalWorkingDays = +document.getElementById('totalWorkingDays').value;
  
  if(!totalWorkingDays) {
    document.getElementById('resMsg').textContent = "‚ö† Enter Total Working Days!";
    document.getElementById('resMsg').className = "message error";
    return;
  }
  
  try {
    const snap = await get(child(ref(db), "students"));
    if(!snap.exists()) {
      document.getElementById('resMsg').textContent = "‚ö† No Students!";
      document.getElementById('resMsg').className = "message error";
      return;
    }
    
    const promises = [];
    snap.forEach(child => {
      const student = child.val();
      const positionValue = document.getElementById('p_' + student.roll)?.value || '';
      const presentDays = +document.getElementById('a_' + student.roll)?.value || 0;
      const absentDays = totalWorkingDays - presentDays;
      const autoFine = absentDays > 0 ? absentDays * 10 : 0;
      
      // Calculate attendance percentage
      const attendancePercentage = totalWorkingDays > 0 ? Math.round((presentDays / totalWorkingDays) * 100) : 0;
      
      const resultData = {
        roll: student.roll,
        name: student.name,
        class: student.category,
        month: month,
        namazObt: document.getElementById('n_' + student.roll)?.value || 0,
        kalmaObt: document.getElementById('k_' + student.roll)?.value || 0,
        quranObt: document.getElementById('q_' + student.roll)?.value || 0,
        presentDays: presentDays,
        totalWorkingDays: totalWorkingDays,
        attendancePercentage: attendancePercentage,
        position: positionValue,
        fine: autoFine,
        finePaid: false,
        namazTotal: nT,
        kalmaTotal: kT,
        quranTotal: qT
      };
      
      promises.push(set(ref(db, "results/" + student.roll + "_" + month), resultData));
    });
    
    await Promise.all(promises);
    document.getElementById('resMsg').textContent = "‚úÖ All Results Saved with Auto Attendance!";
    document.getElementById('resMsg').className = "message success";
    
    // Clear form
    setTimeout(() => {
      document.getElementById('resMsg').textContent = '';
      document.getElementById('resMsg').className = '';
    }, 3000);
    
  } catch (error) {
    document.getElementById('resMsg').textContent = "‚ùå Error saving results: " + error.message;
    document.getElementById('resMsg').className = "message error";
  }
};

// Load All Results
window.loadAllResults = async () => {
  try {
    const snap = await get(child(ref(db), "results"));
    const tbody = document.getElementById('allResultsTable');
    
    if(!snap.exists()) {
      tbody.innerHTML = `<tr><td colspan="10" class="text-center">No results found</td></tr>`;
      return;
    }
    
    let html = '';
    let count = 1;
    const results = [];
    
    snap.forEach(child => {
      results.push({...child.val(), key: child.key});
    });
    
    // Sort by month and roll number
    results.sort((a, b) => {
      if (a.month === b.month) {
        return a.roll.localeCompare(b.roll, undefined, {numeric: true});
      }
      return a.month.localeCompare(b.month);
    });
    
    results.forEach(r => {
      const obt = (+r.namazObt || 0) + (+r.kalmaObt || 0) + (+r.quranObt || 0);
      const total = (+r.namazTotal || 0) + (+r.kalmaTotal || 0) + (+r.quranTotal || 0);
      
      let positionClass = "";
      let positionDisplay = r.position || "-";
      let positionIcon = "";
      
      if(r.position === "1st") {
        positionClass = "position-1st";
        positionIcon = "ü•á";
      } else if(r.position === "2nd") {
        positionClass = "position-2nd";
        positionIcon = "ü•à";
      } else if(r.position === "3rd") {
        positionClass = "position-3rd";
        positionIcon = "ü•â";
      } else if(r.position === "Pass") {
        positionClass = "position-pass";
        positionIcon = "‚úÖ";
      }
      
      const fineStatus = r.finePaid ? 
        `<span style="color: var(--success); font-weight: bold;">‚úÖ Paid</span>` : 
        `<span style="color: var(--danger); font-weight: bold;">‚ùå Pending</span>`;
      
      html += `<tr>
        <td>${count}</td>
        <td><strong>${r.roll}</strong></td>
        <td>${r.name}</td>
        <td>${r.class}</td>
        <td>${r.month}</td>
        <td><strong>${obt}/${total}</strong></td>
        <td>${r.presentDays}/${r.totalWorkingDays} (${r.attendancePercentage}%)</td>
        <td class="${positionClass}">${positionIcon} ${positionDisplay}</td>
        <td><strong>‚Çπ ${r.fine || 0}</strong><br>${fineStatus}</td>
        <td>
          <button class="btn-info" onclick="editResult('${r.key}')" style="margin: 2px;">‚úèÔ∏è</button>
          <button class="btn-success" onclick="payFine('${r.key}')" style="margin: 2px;">üí∞</button>
          <button class="btn-danger" onclick="deleteResult('${r.key}')" style="margin: 2px;">üóëÔ∏è</button>
        </td>
      </tr>`;
      count++;
    });
    
    tbody.innerHTML = html;
    
  } catch (error) {
    console.error("Error loading results:", error);
    tbody.innerHTML = `<tr><td colspan="10" class="text-center">Error loading results</td></tr>`;
  }
};

// Pay Fine function
window.payFine = async (key) => {
  if(confirm("Mark this fine as paid? This action cannot be undone.")) {
    try {
      const resultRef = ref(db, "results/" + key);
      await update(resultRef, { finePaid: true });
      loadAllResults();
      alert("‚úÖ Fine marked as paid!");
    } catch (error) {
      alert("‚ùå Error updating fine status: " + error.message);
    }
  }
};

// Edit Result
window.editResult = async (key) => {
  try {
    const resultRef = ref(db, "results/" + key);
    const snapshot = await get(resultRef);
    
    if (!snapshot.exists()) {
      alert("‚ùå Result not found!");
      return;
    }
    
    const result = snapshot.val();
    
    // Create edit form
    const editForm = document.createElement('div');
    editForm.className = 'confirmation-dialog';
    editForm.innerHTML = `
      <div class="card-header">
        <span>‚úèÔ∏è</span>
        <h3>Edit Result</h3>
      </div>
      <div style="text-align: left; margin: 20px 0;">
        <p><strong>Student:</strong> ${result.name} (${result.roll})</p>
        <p><strong>Month:</strong> ${result.month}</p>
        <p><strong>Class:</strong> ${result.class}</p>
      </div>
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 20px 0;">
        <div>
          <label>Namaz Marks</label>
          <input type="number" id="editNamazObt" value="${result.namazObt || 0}" placeholder="Namaz obtained">
        </div>
        <div>
          <label>Kalma Marks</label>
          <input type="number" id="editKalmaObt" value="${result.kalmaObt || 0}" placeholder="Kalma obtained">
        </div>
        <div>
          <label>Nazra Marks</label>
          <input type="number" id="editQuranObt" value="${result.quranObt || 0}" placeholder="Nazra obtained">
        </div>
        <div>
          <label>Present Days</label>
          <input type="number" id="editPresentDays" value="${result.presentDays || 0}" placeholder="Present days">
        </div>
        <div>
          <label>Working Days</label>
          <input type="number" id="editTotalWorkingDays" value="${result.totalWorkingDays || 0}" placeholder="Total working days">
        </div>
        <div>
          <label>Fine Amount</label>
          <input type="number" id="editFine" value="${result.fine || 0}" placeholder="Fine amount">
        </div>
        <div>
          <label>Position</label>
          <select id="editPosition">
            <option value="">Select Position</option>
            <option value="1st" ${result.position === '1st' ? 'selected' : ''}>ü•á 1st Position</option>
            <option value="2nd" ${result.position === '2nd' ? 'selected' : ''}>ü•à 2nd Position</option>
            <option value="3rd" ${result.position === '3rd' ? 'selected' : ''}>ü•â 3rd Position</option>
            <option value="Pass" ${result.position === 'Pass' ? 'selected' : ''}>‚úÖ Pass</option>
          </select>
        </div>
      </div>
      <div class="btn-group">
        <button class="btn-success" onclick="updateResult('${key}')">
          <span>üíæ</span> Update Result
        </button>
        <button class="btn-warning" onclick="closeEditForm()">
          <span>‚ùå</span> Cancel
        </button>
      </div>
    `;
    
    const overlay = document.createElement('div');
    overlay.className = 'overlay';
    
    document.body.appendChild(overlay);
    document.body.appendChild(editForm);
    
    window.closeEditForm = () => {
      document.body.removeChild(overlay);
      document.body.removeChild(editForm);
    };
    
  } catch (error) {
    alert("‚ùå Error loading result: " + error.message);
  }
};

// Update Result
window.updateResult = async (key) => {
  const resultRef = ref(db, "results/" + key);
  
  const namazObt = +document.getElementById('editNamazObt').value || 0;
  const kalmaObt = +document.getElementById('editKalmaObt').value || 0;
  const quranObt = +document.getElementById('editQuranObt').value || 0;
  const presentDays = +document.getElementById('editPresentDays').value || 0;
  const totalWorkingDays = +document.getElementById('editTotalWorkingDays').value || 0;
  const fine = +document.getElementById('editFine').value || 0;
  const position = document.getElementById('editPosition').value;
  
  // Calculate attendance percentage
  const attendancePercentage = totalWorkingDays > 0 ? Math.round((presentDays / totalWorkingDays) * 100) : 0;
  
  const updates = {
    namazObt: namazObt,
    kalmaObt: kalmaObt,
    quranObt: quranObt,
    presentDays: presentDays,
    totalWorkingDays: totalWorkingDays,
    attendancePercentage: attendancePercentage,
    fine: fine,
    position: position
  };
  
  try {
    await update(resultRef, updates);
    window.closeEditForm();
    loadAllResults();
    alert("‚úÖ Result updated successfully!");
  } catch (error) {
    alert("‚ùå Error updating result: " + error.message);
  }
};

// Delete Result
window.deleteResult = async (key) => {
  if(confirm("Are you sure you want to delete this result?")) {
    try {
      await remove(ref(db, "results/" + key));
      loadAllResults();
      alert("‚úÖ Result deleted successfully!");
    } catch (error) {
      alert("‚ùå Error deleting result: " + error.message);
    }
  }
};

// Delete All Results
window.showDeleteConfirmation = () => {
  const dialog = document.createElement('div');
  dialog.className = 'confirmation-dialog';
  dialog.innerHTML = `
    <div class="card-header">
      <span>‚ö†Ô∏è</span>
      <h3>Delete All Results</h3>
    </div>
    <p style="margin: 20px 0; font-size: 1.1rem;">Are you sure you want to delete ALL results?</p>
    <p style="color: var(--danger); font-weight: bold; margin: 15px 0;">This action cannot be undone!</p>
    <div class="btn-group">
      <button class="btn-danger" onclick="deleteAllResults()">
        <span>üóëÔ∏è</span> Yes, Delete All
      </button>
      <button class="btn-warning" onclick="closeConfirmation()">
        <span>‚ùå</span> Cancel
      </button>
    </div>
  `;
  
  const overlay = document.createElement('div');
  overlay.className = 'overlay';
  
  document.body.appendChild(overlay);
  document.body.appendChild(dialog);
  
  window.closeConfirmation = () => {
    document.body.removeChild(overlay);
    document.body.removeChild(dialog);
  };
};

window.deleteAllResults = async () => {
  try {
    await remove(ref(db, "results"));
    window.closeConfirmation();
    loadAllResults();
    alert("‚úÖ All results deleted successfully!");
  } catch (error) {
    alert("‚ùå Error deleting results: " + error.message);
  }
};

// Check Result (Public) - WITH ULTRA BEAUTIFUL VIP DISPLAY
window.checkResult = async () => {
  const roll = document.getElementById('searchRoll').value.trim();
  if(!roll) {
    document.getElementById('resultOutput').innerHTML = `
      <div class="message error">
        ‚ö† Please enter a roll number
      </div>
    `;
    return;
  }
  
  try {
    const resultsSnap = await get(child(ref(db), "results"));
    
    if(!resultsSnap.exists()) {
      // Check if student exists
      const studentSnap = await get(ref(db, "students/" + roll));
      if(studentSnap.exists()){
        const student = studentSnap.val();
        document.getElementById('resultOutput').innerHTML = `
          <div class="vip-result-display">
            <div class="corner-decoration corner-tl"></div>
            <div class="corner-decoration corner-tr"></div>
            <div class="corner-decoration corner-bl"></div>
            <div class="corner-decoration corner-br"></div>
            
            <div class="vip-header">
              <div class="vip-student-info">
                <h2 class="vip-font-bold">${student.name}</h2>
                <div class="vip-student-meta">
                  <div class="vip-meta-item">
                    <span>üé´</span> Roll: ${student.roll}
                  </div>
                  <div class="vip-meta-item">
                    <span>üìö</span> Class: ${student.category}
                  </div>
                </div>
              </div>
            </div>
            
            <div class="vip-remarks-section">
              <div class="vip-remarks-header">
                <span>üìã</span>
                <h3>Result Status</h3>
              </div>
              <div class="vip-remarks-content vip-font">
                No result available yet. Please check back later.
              </div>
            </div>
          </div>
        `;
      } else {
        document.getElementById('resultOutput').innerHTML = `
          <div class="message error">
            ‚ùå No record found for roll number: ${roll}
          </div>
        `;
      }
      return;
    }
    
    let found = false;
    let latestResult = null;
    
    // Find the latest result for this roll number
    resultsSnap.forEach(child => {
      const result = child.val();
      if(result.roll === roll){
        found = true;
        if(!latestResult || result.month > latestResult.month) {
          latestResult = result;
        }
      }
    });
    
    if(found && latestResult) {
      const result = latestResult;
      const obt = (+result.namazObt) + (+result.kalmaObt) + (+result.quranObt);
      const total = (+result.namazTotal) + (+result.kalmaTotal) + (+result.quranTotal);
      const percentage = total > 0 ? Math.round((obt / total) * 100) : 0;
      
      // Calculate percentages for each subject
      const namazPercentage = result.namazTotal > 0 ? Math.round((result.namazObt / result.namazTotal) * 100) : 0;
      const kalmaPercentage = result.kalmaTotal > 0 ? Math.round((result.kalmaObt / result.kalmaTotal) * 100) : 0;
      const quranPercentage = result.quranTotal > 0 ? Math.round((result.quranObt / result.quranTotal) * 100) : 0;
      
      let positionClass = "";
      let positionDisplay = result.position || "Not assigned";
      let positionIcon = "";
      let cardClass = "";
      
      if(result.position === "1st") {
        positionClass = "position-1st";
        positionIcon = "ü•á";
        cardClass = "gold-card";
      } else if(result.position === "2nd") {
        positionClass = "position-2nd";
        positionIcon = "ü•à";
        cardClass = "silver-card";
      } else if(result.position === "3rd") {
        positionClass = "position-3rd";
        positionIcon = "ü•â";
        cardClass = "bronze-card";
      } else if(result.position === "Pass") {
        positionClass = "position-pass";
        positionIcon = "‚úÖ";
      }
      
      // Check if student has marks (not absent)
      const hasMarks = (+result.namazObt || +result.kalmaObt || +result.quranObt) > 0;
      
      // Get admin remarks from database
      let adminRemarks = "Excellent performance! Keep up the good work.";
      const remarksSnap = await get(ref(db, `remarks/${result.roll}`));
      if (remarksSnap.exists()) {
        adminRemarks = remarksSnap.val().remarks || adminRemarks;
      }
      
      // Create ULTRA BEAUTIFUL VIP result display
      document.getElementById('resultOutput').innerHTML = `
        <div class="vip-result-display ${cardClass}">
          <div class="corner-decoration corner-tl"></div>
          <div class="corner-decoration corner-tr"></div>
          <div class="corner-decoration corner-bl"></div>
          <div class="corner-decoration corner-br"></div>
          
          <div class="vip-header">
            <div class="vip-student-info">
              <h2 class="vip-font-bold">${result.name}</h2>
              <div class="vip-student-meta">
                <div class="vip-meta-item">
                  <span>üé´</span> Roll: ${result.roll}
                </div>
                <div class="vip-meta-item">
                  <span>üìö</span> Class: ${result.class}
                </div>
                <div class="vip-meta-item">
                  <span>üìÖ</span> Month: ${result.month}
                </div>
              </div>
            </div>
            <div class="vip-position-badge">
              ${positionIcon} ${positionDisplay}
            </div>
          </div>
          
          <div class="vip-results-grid">
            <div class="vip-result-item">
              <h4>Namaz</h4>
              <div class="vip-result-value">${result.namazObt}/${result.namazTotal}</div>
              <div class="vip-result-progress">
                <div class="vip-result-progress-fill" style="width: ${namazPercentage}%"></div>
              </div>
              <div class="vip-percentage">${namazPercentage}%</div>
            </div>
            <div class="vip-result-item">
              <h4>Kalma</h4>
              <div class="vip-result-value">${result.kalmaObt}/${result.kalmaTotal}</div>
              <div class="vip-result-progress">
                <div class="vip-result-progress-fill" style="width: ${kalmaPercentage}%"></div>
              </div>
              <div class="vip-percentage">${kalmaPercentage}%</div>
            </div>
            <div class="vip-result-item">
              <h4>Nazra</h4>
              <div class="vip-result-value">${result.quranObt}/${result.quranTotal}</div>
              <div class="vip-result-progress">
                <div class="vip-result-progress-fill" style="width: ${quranPercentage}%"></div>
              </div>
              <div class="vip-percentage">${quranPercentage}%</div>
            </div>
            <div class="vip-result-item">
              <h4>Total</h4>
              <div class="vip-result-value">${obt}/${total}</div>
              <div class="vip-result-progress">
                <div class="vip-result-progress-fill" style="width: ${percentage}%"></div>
              </div>
              <div class="vip-percentage">${percentage}% Overall</div>
            </div>
          </div>
          
          <div class="vip-stats-grid">
            <div class="vip-stat-card">
              <span class="vip-stat-icon">üèÜ</span>
              <div class="${positionClass}" style="font-size: 2.5rem; margin: 10px 0;">${positionIcon} ${positionDisplay}</div>
              <div class="vip-stat-label">Position</div>
            </div>
            <div class="vip-stat-card">
              <span class="vip-stat-icon">üìÖ</span>
              <div class="vip-stat-value">${result.attendancePercentage}%</div>
              <div class="vip-stat-label">Attendance</div>
              <div style="color: var(--text-light); font-size: 0.9rem; margin-top: 5px;">${result.presentDays}/${result.totalWorkingDays} days</div>
            </div>
            <div class="vip-stat-card">
              <span class="vip-stat-icon">üí∞</span>
              <div class="vip-stat-value">‚Çπ ${result.fine || 0}</div>
              <div class="vip-stat-label">Fine Amount</div>
              <div style="color: ${result.finePaid ? 'var(--success)' : 'var(--danger)'}; font-weight: bold; margin-top: 5px;">
                ${result.finePaid ? '‚úÖ Paid' : '‚ùå Pending'}
              </div>
            </div>
          </div>
          
          <div class="vip-remarks-section">
            <div class="vip-remarks-header">
              <span>üí¨</span>
              <h3>Teacher's Remarks</h3>
            </div>
            <div class="vip-remarks-content vip-font">
              ${adminRemarks}
            </div>
          </div>
          
          ${!hasMarks ? `
            <div class="message error mt-30">
              <strong>‚ö†Ô∏è ABSENT</strong>
              <p>Student was absent for this month's examination.</p>
            </div>
          ` : ''}
        </div>
      `;
    } else {
      // Student exists but has no results
      const studentSnap = await get(ref(db, "students/" + roll));
      if(studentSnap.exists()){
        const student = studentSnap.val();
        document.getElementById('resultOutput').innerHTML = `
          <div class="vip-result-display">
            <div class="corner-decoration corner-tl"></div>
            <div class="corner-decoration corner-tr"></div>
            <div class="corner-decoration corner-bl"></div>
            <div class="corner-decoration corner-br"></div>
            
            <div class="vip-header">
              <div class="vip-student-info">
                <h2 class="vip-font-bold">${student.name}</h2>
                <div class="vip-student-meta">
                  <div class="vip-meta-item">
                    <span>üé´</span> Roll: ${student.roll}
                  </div>
                  <div class="vip-meta-item">
                    <span>üìö</span> Class: ${student.category}
                  </div>
                </div>
              </div>
            </div>
            
            <div class="vip-remarks-section">
              <div class="vip-remarks-header">
                <span>üìã</span>
                <h3>Result Status</h3>
              </div>
              <div class="vip-remarks-content vip-font">
                No result available for this student yet. Please check back after the monthly examination.
              </div>
            </div>
          </div>
        `;
      } else {
        document.getElementById('resultOutput').innerHTML = `
          <div class="message error">
            ‚ùå No record found for roll number: ${roll}
          </div>
        `;
      }
    }
  } catch (error) {
    console.error("Error checking result:", error);
    document.getElementById('resultOutput').innerHTML = `
      <div class="message error">
        ‚ùå Error checking result. Please try again.
      </div>
    `;
  }
};

// Change Admin Code
window.changeAdminCode = async () => {
  const old = document.getElementById('oldCode').value.trim();
  const newC = document.getElementById('newCode').value.trim();
  
  if(!old || !newC) {
    document.getElementById('codeMsg').textContent = "‚ö† Please enter both current and new passwords!";
    document.getElementById('codeMsg').className = "message error";
    return;
  }
  
  try {
    const snap = await get(ref(db, "admin/code"));
    const realCode = snap.exists() ? snap.val() : "1300";
    
    if(old === realCode) {
      await set(ref(db, "admin/code"), newC);
      document.getElementById('codeMsg').textContent = "‚úÖ Admin password changed successfully!";
      document.getElementById('codeMsg').className = "message success";
      document.getElementById('oldCode').value = '';
      document.getElementById('newCode').value = '';
    } else {
      document.getElementById('codeMsg').textContent = "‚ùå Current password is incorrect!";
      document.getElementById('codeMsg').className = "message error";
    }
  } catch (error) {
    document.getElementById('codeMsg').textContent = "‚ùå Error changing password: " + error.message;
    document.getElementById('codeMsg').className = "message error";
  }
};

// Load students for remarks
async function loadStudentsForRemarks() {
  try {
    const snap = await get(child(ref(db), "students"));
    const select = document.getElementById('remarkStudentSelect');
    
    select.innerHTML = '<option value="">Select student...</option>';
    
    if (snap.exists()) {
      const students = [];
      snap.forEach(child => {
        students.push(child.val());
      });
      
      // Sort students by name
      students.sort((a, b) => a.name.localeCompare(b.name));
      
      students.forEach(student => {
        const option = document.createElement('option');
        option.value = student.roll;
        option.textContent = `${student.roll} - ${student.name} (${student.category})`;
        select.appendChild(option);
      });
    }
  } catch (error) {
    console.error("Error loading students for remarks:", error);
  }
}

// Load student remark
window.loadStudentRemark = async () => {
  const roll = document.getElementById('remarkStudentSelect').value;
  
  if (!roll) {
    document.getElementById('remarkFormContainer').innerHTML = '';
    return;
  }
  
  try {
    // Get student info
    const studentSnap = await get(ref(db, "students/" + roll));
    if (!studentSnap.exists()) {
      document.getElementById('remarkFormContainer').innerHTML = '<div class="message error">Student not found</div>';
      return;
    }
    
    const student = studentSnap.val();
    
    // Get existing remark
    let existingRemark = "";
    const remarkSnap = await get(ref(db, `remarks/${roll}`));
    if (remarkSnap.exists()) {
      existingRemark = remarkSnap.val().remarks || "";
    }
    
    document.getElementById('remarkFormContainer').innerHTML = `
      <div style="margin: 20px 0;">
        <p><strong>Student:</strong> ${student.name} (${student.roll})</p>
        <p><strong>Class:</strong> ${student.category}</p>
      </div>
      <div>
        <label>Teacher's Remarks</label>
        <textarea id="studentRemark" placeholder="Enter remarks for this student..." rows="4">${existingRemark}</textarea>
      </div>
      <div class="btn-group">
        <button class="btn-success" onclick="saveStudentRemark('${roll}')">
          <span>üíæ</span> Save Remarks
        </button>
      </div>
    `;
    
  } catch (error) {
    document.getElementById('remarkFormContainer').innerHTML = `<div class="message error">Error: ${error.message}</div>`;
  }
};

// Save student remark
window.saveStudentRemark = async (roll) => {
  const remarks = document.getElementById('studentRemark').value.trim();
  
  if (!remarks) {
    document.getElementById('remarkMsg').textContent = "‚ö† Please enter remarks!";
    document.getElementById('remarkMsg').className = "message error";
    return;
  }
  
  try {
    // Get student info
    const studentSnap = await get(ref(db, "students/" + roll));
    if (!studentSnap.exists()) {
      document.getElementById('remarkMsg').textContent = "‚ùå Student not found!";
      document.getElementById('remarkMsg').className = "message error";
      return;
    }
    
    const student = studentSnap.val();
    
    // Save remarks
    await set(ref(db, `remarks/${roll}`), {
      roll: roll,
      name: student.name,
      class: student.category,
      remarks: remarks,
      updatedAt: new Date().toISOString()
    });
    
    document.getElementById('remarkMsg').textContent = "‚úÖ Remarks saved successfully!";
    document.getElementById('remarkMsg').className = "message success";
    
    // Clear message after 3 seconds
    setTimeout(() => {
      document.getElementById('remarkMsg').textContent = '';
      document.getElementById('remarkMsg').className = '';
    }, 3000);
    
  } catch (error) {
    document.getElementById('remarkMsg').textContent = "‚ùå Error saving remarks: " + error.message;
    document.getElementById('remarkMsg').className = "message error";
  }
};

// Initialize the page
window.onload = function() {
  // Set today's date for attendance
  const today = new Date().toISOString().split('T')[0];
  document.getElementById('attendanceDate').value = today;
  document.getElementById('deleteAttendanceDate').value = today;
  document.getElementById('exitDate').value = today;
  
  // Set current month
  const currentMonth = new Date().toLocaleString('default', { month: 'long' });
  document.getElementById('monthInput').value = currentMonth;
  
  // Set max date for exit date to today
  document.getElementById('exitDate').max = today;
};
</script>
</body>
</html>