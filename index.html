<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Faizan-e-Raza Madarsa Result Portal</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f5fff5; margin: 0; padding: 0; }
    header { background: linear-gradient(to right, #228b22, #d4af37); color: white; text-align: center; padding: 1rem; font-size: 1.4rem; font-weight: bold; }
    nav { display: flex; justify-content: center; background: #e8f5e9; border-bottom: 2px solid #c5e1a5; flex-wrap: wrap; }
    nav button { margin: 5px; padding: 10px 18px; border: none; background: #2e7d32; color: white; border-radius: 5px; cursor: pointer; }
    nav button:hover { background: #1b5e20; }
    section { display: none; padding: 20px; }
    .active { display: block; }
    .hidden { display: none; }
    input, select { width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ccc; border-radius: 5px; }
    .btn { background: #388e3c; color: white; border: none; padding: 8px 14px; border-radius: 5px; cursor: pointer; margin-top: 5px; }
    .btn:hover { background: #2e7d32; }
  </style>
</head>
<body>
  <header>üïå Faizan-e-Raza Madarsa Result Portal</header>

  <nav>
    <button onclick="showSection('resultSection')">Check Result</button>
    <button id="loginBtn" onclick="showSection('loginSection')">Admin Login</button>
    <button id="studentBtn" class="hidden" onclick="showSection('studentSection')">Add Student</button>
    <button id="resultBtn" class="hidden" onclick="showSection('addResultSection')">Add Result</button>
    <button id="logoutBtn" class="hidden" onclick="adminLogout()">Logout</button>
  </nav>

  <!-- üîπ Result Check -->
  <section id="resultSection" class="active">
    <h2>Check Student Result</h2>
    <input type="text" id="searchRoll" placeholder="Enter Roll Number">
    <button class="btn" onclick="checkResult()">Check</button>
    <div id="resultOutput"></div>
  </section>

  <!-- üîπ Admin Login -->
  <section id="loginSection">
    <h2>Admin Login</h2>
    <input type="password" id="adminCode" placeholder="Enter Admin Code">
    <button class="btn" onclick="adminLogin()">Login</button>
    <p id="loginMsg"></p>
  </section>

  <!-- üîπ Add Student -->
  <section id="studentSection">
    <h2>Add Student</h2>
    <input type="text" id="name" placeholder="Student Name">
    <input type="text" id="roll" placeholder="Roll Number">
    <input type="date" id="admission" placeholder="Admission Date">
    <button class="btn" onclick="addStudent()">Add Student</button>
    <p id="stdMsg"></p>
  </section>

  <!-- üîπ Add Result -->
  <section id="addResultSection">
    <h2>Add Result</h2>
    <input type="text" id="rRoll" placeholder="Roll Number">
    <input type="text" id="rName" placeholder="Name">
    <input type="text" id="month" placeholder="Month (e.g. October)">
    <input type="number" id="namazObt" placeholder="Namaz Obtained">
    <input type="number" id="namazTotal" placeholder="Namaz Total">
    <input type="number" id="quranObt" placeholder="Quran Obtained">
    <input type="number" id="quranTotal" placeholder="Quran Total">
    <input type="number" id="kalmaObt" placeholder="Kalma Obtained">
    <input type="number" id="kalmaTotal" placeholder="Kalma Total">
    <input type="number" id="attendance" placeholder="Attendance (%)">
    <button class="btn" onclick="addResult()">Add Result</button>
    <p id="resMsg"></p>
  </section>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getDatabase, ref, set, get, child } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyB_zOJiXH5ZSHs4miirkF4p7Fc6NUDuNiY",
      authDomain: "faizan-e-raza-madarsa-8c743.firebaseapp.com",
      databaseURL: "https://faizan-e-raza-madarsa-8c743-default-rtdb.firebaseio.com",
      projectId: "faizan-e-raza-madarsa-8c743",
      storageBucket: "faizan-e-raza-madarsa-8c743.firebasestorage.app",
      messagingSenderId: "659467130617",
      appId: "1:659467130617:web:9ed42e7bb8e3eea5917428"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // --- Section Switch ---
    window.showSection = function (id) {
      document.querySelectorAll("section").forEach(s => s.classList.remove("active"));
      document.getElementById(id).classList.add("active");
    };

    // --- Admin Login ---
    const adminCodeValue = "6457";

    window.adminLogin = function () {
      const inputCode = document.getElementById("adminCode").value.trim();
      const msg = document.getElementById("loginMsg");

      if (inputCode === adminCodeValue) {
        msg.textContent = "‚úÖ Login Successful!";
        msg.style.color = "green";
        document.getElementById("loginBtn").classList.add("hidden");
        document.getElementById("logoutBtn").classList.remove("hidden");
        document.getElementById("studentBtn").classList.remove("hidden");
        document.getElementById("resultBtn").classList.remove("hidden");
        showSection("studentSection");
      } else {
        msg.textContent = "‚ùå Wrong Code!";
        msg.style.color = "red";
      }
    };

    // --- Admin Logout ---
    window.adminLogout = function () {
      document.getElementById("loginBtn").classList.remove("hidden");
      document.getElementById("logoutBtn").classList.add("hidden");
      document.getElementById("studentBtn").classList.add("hidden");
      document.getElementById("resultBtn").classList.add("hidden");
      showSection("resultSection");
      alert("Logged out successfully!");
    };

    // --- Add Student ---
    window.addStudent = function () {
      const name = document.getElementById("name").value.trim();
      const roll = document.getElementById("roll").value.trim();
      const admission = document.getElementById("admission").value;
      const msg = document.getElementById("stdMsg");

      if (!name || !roll) {
        msg.textContent = "‚ö† Please fill all fields!";
        return;
      }

      set(ref(db, "students/" + roll), { name, roll, admission })
        .then(() => msg.textContent = "‚úÖ Student Added Successfully!")
        .catch(err => msg.textContent = "‚ùå Error: " + err.message);
    };

    // --- Add Result ---
    window.addResult = function () {
      const roll = document.getElementById("rRoll").value.trim();
      const name = document.getElementById("rName").value.trim();
      const month = document.getElementById("month").value.trim();
      const namazObt = document.getElementById("namazObt").value;
      const namazTotal = document.getElementById("namazTotal").value;
      const quranObt = document.getElementById("quranObt").value;
      const quranTotal = document.getElementById("quranTotal").value;
      const kalmaObt = document.getElementById("kalmaObt").value;
      const kalmaTotal = document.getElementById("kalmaTotal").value;
      const attendance = document.getElementById("attendance").value;
      const msg = document.getElementById("resMsg");

      if (!roll || !name || !month) {
        msg.textContent = "‚ö† Please fill all main fields!";
        return;
      }

      set(ref(db, "results/" + roll), {
        roll, name, month,
        namazObt, namazTotal,
        quranObt, quranTotal,
        kalmaObt, kalmaTotal,
        attendance
      }).then(() => msg.textContent = "‚úÖ Result Added Successfully!");
    };

    // --- Check Result (for Parents) ---
    window.checkResult = function () {
      const roll = document.getElementById("searchRoll").value.trim();
      const output = document.getElementById("resultOutput");
      const dbRef = ref(db);

      get(child(dbRef, "results/" + roll)).then(snapshot => {
        if (snapshot.exists()) {
          const d = snapshot.val();
          output.innerHTML = `
            <h3>${d.name} (Roll: ${d.roll})</h3>
            <p><b>Month:</b> ${d.month}</p>
            <p>üïå Namaz: ${d.namazObt}/${d.namazTotal}</p>
            <p>üìñ Quran: ${d.quranObt}/${d.quranTotal}</p>
            <p>‚ò™ Kalma: ${d.kalmaObt}/${d.kalmaTotal}</p>
            <p>üìÖ Attendance: ${d.attendance}%</p>
          `;
        } else {
          output.innerHTML = "‚ùå No record found!";
        }
      });
    };
  </script>
</body>
</html>